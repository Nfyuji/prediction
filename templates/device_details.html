{% extends "base.html" %}

{% block title %}تفاصيل الجهاز - {{ device.name }}{% endblock %}

{% block content %}
<div class="device-details-page" data-device-id="{{ device.id }}">
    <!-- رأس الصفحة -->
    <div class="page-header">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <nav class="breadcrumb">
                            <a href="{{ url_for('dashboard.index') }}" class="breadcrumb-item">الرئيسية</a>
                            <a href="{{ url_for('devices.devices_list') }}" class="breadcrumb-item">الأجهزة</a>
                            <span class="breadcrumb-item active">{{ device.name }}</span>
                        </nav>
                        <h1 class="page-title">
                            <i class="fas fa-desktop"></i>
                            {{ device.name }}
                        </h1>
                        <p class="page-subtitle">
                            <i class="fas fa-map-marker-alt"></i>
                            {{ device.location }}
                        </p>
                    </div>
                    <div class="page-actions">
                        <button class="btn btn-primary" id="refresh-btn" data-action="refresh">
                            <i class="fas fa-sync-alt"></i>
                            تحديث
                        </button>
                        {% if session.role in ['admin', 'technician', 'manager'] %}
                        <button class="btn btn-warning" onclick="showDeviceActions()">
                            <i class="fas fa-cog"></i>
                            إجراءات
                        </button>
                        {% endif %}
                        <a href="{{ url_for('devices.devices_list') }}" class="btn btn-outline-primary">
                            <i class="fas fa-arrow-right"></i>
                            العودة للأجهزة
                        </a>
                        <a href="{{ url_for('alerts.alerts_list') }}" class="btn btn-outline-warning">
                            <i class="fas fa-bell"></i>
                            التنبيهات
                        </a>
                        <a href="{{ url_for('reports') }}" class="btn btn-outline-info">
                            <i class="fas fa-chart-bar"></i>
                            التقارير
                        </a>
                        <a href="{{ url_for('analytics.analytics_page') }}" class="btn btn-outline-success">
                            <i class="fas fa-chart-line"></i>
                            التحليلات
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- حالة الجهاز -->
    <div class="device-status-section">
        <div class="card">
            <div class="card-body">
                <div class="status-overview">
                    <div class="status-main">
                        <div class="status-icon {{ device.status }}">
                            <i class="fas fa-{{ 'check-circle' if device.status == 'healthy' else 'exclamation-triangle' if device.status == 'warning' else 'exclamation-circle' }}"></i>
                        </div>
                        <div class="status-info">
                            <h2 class="status-title">
                                {% if device.status == 'healthy' %}
                                    الجهاز يعمل بشكل طبيعي
                                {% elif device.status == 'warning' %}
                                    الجهاز يحتاج إلى انتباه
                                {% else %}
                                    الجهاز في حالة حرجة
                                {% endif %}
                            </h2>
                            <p class="status-description">
                                {% if device.status == 'healthy' %}
                                    جميع المؤشرات ضمن المعدلات الطبيعية
                                {% elif device.status == 'warning' %}
                                    بعض المؤشرات تتطلب مراقبة
                                {% else %}
                                    الجهاز يحتاج إلى تدخل فوري
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    <div class="status-badge">
                        <span class="status status-{{ device.status }}">
                            {% if device.status == 'healthy' %}
                                سليم
                            {% elif device.status == 'warning' %}
                                تحذير
                            {% else %}
                                حرج
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- مؤشرات الأداء -->
    <div class="performance-metrics">
        <div class="grid grid-2">
            <!-- استخدام المعالج -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-microchip"></i>
                        استخدام المعالج (CPU)
                    </h3>
                </div>
                <div class="card-body">
                    {% if device.cpu_usage is none %}
                    <div style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.6);">
                        <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <p>لا توجد بيانات بعد</p>
                    </div>
                    {% else %}
                    <div class="metric-display">
                        <div class="metric-value">{{ device.cpu_usage }}%</div>
                        <div class="progress">
                            <div class="progress-bar" 
                                 data-width="{{ device.cpu_usage }}"
                                 data-usage="{{ device.cpu_usage }}"></div>
                        </div>
                        <div class="metric-info">
                            <span class="metric-label">المعدل الطبيعي: 0-70%</span>
                            <span class="metric-status {{ 'warning' if device.cpu_usage > 70 else 'danger' if device.cpu_usage > 90 else 'normal' }}">
                                {% if device.cpu_usage > 90 %}
                                    حرج
                                {% elif device.cpu_usage > 70 %}
                                    تحذير
                                {% else %}
                                    طبيعي
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- استخدام الذاكرة -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-memory"></i>
                        استخدام الذاكرة (RAM)
                    </h3>
                </div>
                <div class="card-body">
                    {% if device.ram_usage is none %}
                    <div style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.6);">
                        <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <p>لا توجد بيانات بعد</p>
                    </div>
                    {% else %}
                    <div class="metric-display">
                        <div class="metric-value">{{ device.ram_usage }}%</div>
                        <div class="progress">
                            <div class="progress-bar" 
                                 data-width="{{ device.ram_usage }}"
                                 data-usage="{{ device.ram_usage }}"></div>
                        </div>
                        <div class="metric-info">
                            <span class="metric-label">المعدل الطبيعي: 0-70%</span>
                            <span class="metric-status {{ 'warning' if device.ram_usage > 70 else 'danger' if device.ram_usage > 90 else 'normal' }}">
                                {% if device.ram_usage > 90 %}
                                    حرج
                                {% elif device.ram_usage > 70 %}
                                    تحذير
                                {% else %}
                                    طبيعي
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- استخدام القرص الصلب -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-hdd"></i>
                        استخدام القرص الصلب
                    </h3>
                </div>
                <div class="card-body">
                    {% if device.disk_usage is none %}
                    <div style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.6);">
                        <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <p>لا توجد بيانات بعد</p>
                    </div>
                    {% else %}
                    <div class="metric-display">
                        <div class="metric-value">{{ device.disk_usage }}%</div>
                        <div class="progress">
                            <div class="progress-bar" 
                                 data-width="{{ device.disk_usage }}"
                                 data-usage="{{ device.disk_usage }}"></div>
                        </div>
                        <div class="metric-info">
                            <span class="metric-label">المعدل الطبيعي: 0-70%</span>
                            <span class="metric-status {{ 'warning' if device.disk_usage > 70 else 'danger' if device.disk_usage > 90 else 'normal' }}">
                                {% if device.disk_usage > 90 %}
                                    حرج
                                {% elif device.disk_usage > 70 %}
                                    تحذير
                                {% else %}
                                    طبيعي
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- درجة الحرارة -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-thermometer-half"></i>
                        درجة الحرارة
                    </h3>
                </div>
                <div class="card-body">
                    {% if device.temperature is none %}
                    <div style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.6);">
                        <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <p>لا توجد بيانات درجة حرارة بعد</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem; color: rgba(255, 255, 255, 0.5);">
                            جاري جمع البيانات... سيتم عرض درجة الحرارة تلقائياً عند توفرها
                        </p>
                    </div>
                    {% elif device.temperature > 0 %}
                    <div class="metric-display">
                        <div class="metric-value">{{ device.temperature }}°C</div>
                        <div class="progress">
                            <div class="progress-bar" 
                                 data-width="{{ (device.temperature / 100) * 100 }}"
                                 data-usage="{{ device.temperature }}"></div>
                        </div>
                        <div class="metric-info">
                            <span class="metric-label">المعدل الطبيعي: 30-70°C</span>
                            <span class="metric-status {{ 'warning' if device.temperature > 70 else 'danger' if device.temperature > 80 else 'normal' }}">
                                {% if device.temperature > 80 %}
                                    حرج
                                {% elif device.temperature > 70 %}
                                    تحذير
                                {% else %}
                                    طبيعي
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- معلومات إضافية -->
    <div class="additional-info">
        <div class="grid grid-2">
            <!-- معلومات البطارية -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-{{ 'battery-full' if device.battery and device.battery > 50 else 'battery-half' if device.battery and device.battery > 25 else 'battery-quarter' if device.battery else 'plug' }}"></i>
                        حالة البطارية
                    </h3>
                </div>
                <div class="card-body">
                    {% if device.battery is none %}
                    <div style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.6);">
                        <i class="fas fa-plug" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <p>جهاز مكتبي (لا يحتوي على بطارية)</p>
                    </div>
                    {% else %}
                    <div class="battery-info">
                        <div class="battery-level">
                            <div class="battery-icon">
                                <i class="fas fa-{{ 'battery-full' if device.battery and device.battery > 50 else 'battery-half' if device.battery and device.battery > 25 else 'battery-quarter' if device.battery else 'plug' }}"></i>
                            </div>
                            <div class="battery-percentage">{{ device.battery }}%</div>
                        </div>
                        <div class="battery-status">
                            {% if device.battery > 50 %}
                                <span class="status-normal">حالة جيدة</span>
                            {% elif device.battery > 25 %}
                                <span class="status-warning">تحتاج شحن</span>
                            {% else %}
                                <span class="status-danger">تحتاج شحن فوري</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- معلومات الاتصال -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-network-wired"></i>
                        معلومات الاتصال
                    </h3>
                </div>
                <div class="card-body">
                    <div class="connection-info">
                        <div class="info-item">
                            <span class="info-label">آخر تحديث:</span>
                            <span class="info-value">{{ device.last_update or device.last_seen or 'غير متصل' }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">حالة الاتصال:</span>
                            <span class="info-value status-{{ 'online' if device.last_seen else 'offline' }}">
                                <i class="fas fa-circle"></i>
                                {{ 'متصل' if device.last_seen else 'غير متصل' }}
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">عنوان IP:</span>
                            <span class="info-value">{{ device.ip_address or 'غير محدد' }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">MAC Address:</span>
                            <span class="info-value">{{ device.mac_address or 'غير محدد' }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">نوع الجهاز:</span>
                            <span class="info-value">{{ device.device_type or 'غير محدد' }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">نظام التشغيل:</span>
                            <span class="info-value">{{ device.operating_system or 'غير محدد' }}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- معلومات المستخدم المالك (للأدمن فقط) -->
            {% if session.role in ['admin', 'technician', 'manager'] and device.owner %}
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-user"></i>
                        معلومات المستخدم المالك
                    </h3>
                </div>
                <div class="card-body">
                    <div class="owner-info">
                        {% if device.owner.username %}
                        <div class="info-item">
                            <span class="info-label">
                                <i class="fas fa-user-circle"></i>
                                اسم المستخدم:
                            </span>
                            <span class="info-value">{{ device.owner.username }}</span>
                        </div>
                        {% endif %}
                        
                        {% if device.owner.full_name %}
                        <div class="info-item">
                            <span class="info-label">
                                <i class="fas fa-id-card"></i>
                                الاسم الكامل:
                            </span>
                            <span class="info-value">{{ device.owner.full_name }}</span>
                        </div>
                        {% endif %}
                        
                        {% if device.owner.email %}
                        <div class="info-item">
                            <span class="info-label">
                                <i class="fas fa-envelope"></i>
                                البريد الإلكتروني:
                            </span>
                            <span class="info-value">
                                <a href="mailto:{{ device.owner.email }}" style="color: #4cc9f0; text-decoration: none;">
                                    {{ device.owner.email }}
                                </a>
                            </span>
                        </div>
                        {% endif %}
                        
                        {% if device.owner.phone %}
                        <div class="info-item">
                            <span class="info-label">
                                <i class="fas fa-phone"></i>
                                رقم الهاتف:
                            </span>
                            <span class="info-value">
                                <a href="tel:{{ device.owner.phone }}" style="color: #4cc9f0; text-decoration: none;">
                                    {{ device.owner.phone }}
                                </a>
                            </span>
                        </div>
                        {% endif %}
                        
                        {% if device.owner.role %}
                        <div class="info-item">
                            <span class="info-label">
                                <i class="fas fa-user-shield"></i>
                                الدور:
                            </span>
                            <span class="info-value">
                                {% if device.owner.role == 'admin' %}
                                    <span class="badge badge-danger">مدير</span>
                                {% elif device.owner.role == 'technician' %}
                                    <span class="badge badge-warning">فني</span>
                                {% elif device.owner.role == 'manager' %}
                                    <span class="badge badge-info">مدير</span>
                                {% else %}
                                    <span class="badge badge-secondary">مستخدم</span>
                                {% endif %}
                            </span>
                        </div>
                        {% endif %}
                        
                        {% if device.owner.user_id %}
                        <div class="info-item">
                            <span class="info-label">
                                <i class="fas fa-hashtag"></i>
                                معرف المستخدم:
                            </span>
                            <span class="info-value" style="font-family: monospace; color: rgba(255, 255, 255, 0.7);">#{{ device.owner.user_id }}</span>
                        </div>
                        {% endif %}
                        
                        {% if not device.owner.username %}
                        <div class="info-item" style="text-align: center; padding: 1rem; color: rgba(255, 255, 255, 0.6);">
                            <i class="fas fa-info-circle" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block;"></i>
                            <p>لا توجد معلومات مستخدم متاحة</p>
                            <p style="font-size: 0.85rem; margin-top: 0.5rem;">قد يكون الجهاز تم تسجيله تلقائياً بدون ربطه بمستخدم</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- إعداد عميل المراقبة -->
    <div class="device-setup-section">
        <div class="card glass">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-download"></i>
                    إعداد عميل المراقبة
                </h3>
            </div>
            <div class="card-body">
                <div class="setup-instructions">
                    <div class="alert alert-info" style="background: rgba(67, 97, 238, 0.1); border: 1px solid rgba(67, 97, 238, 0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                        <i class="fas fa-info-circle"></i>
                        <strong>تعليمات:</strong> قم بتحميل ملفات الإعداد وتشغيلها على الجهاز لبدء إرسال البيانات تلقائياً.
                    </div>

                    <!-- Device Token -->
                    <div class="setup-item">
                        <h4><i class="fas fa-key"></i> Device Token</h4>
                        <div class="token-display">
                            <input type="text" id="device-token-input" readonly 
                                   value="{{ device.device_token or 'غير متوفر' }}" 
                                   class="token-input" 
                                   style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: white; font-family: monospace; font-size: 0.9rem;">
                            <button onclick="copyDeviceToken()" class="btn btn-primary" style="margin-top: 0.5rem;">
                                <i class="fas fa-copy"></i> نسخ Token
                            </button>
                        </div>
                    </div>

                    <!-- Server URL -->
                    <div class="setup-item" style="margin-top: 1.5rem;">
                        <h4><i class="fas fa-server"></i> Server URL</h4>
                        <input type="text" id="server-url-input" 
                               value="{{ request.host_url.rstrip('/') }}" 
                               class="token-input" 
                               placeholder="http://192.168.1.100:5000"
                               style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: white; font-size: 0.9rem;">
                        <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.85rem; margin-top: 0.5rem;">
                            <i class="fas fa-info-circle"></i> استبدل بعنوان IP السيرفر الخاص بك
                        </p>
                    </div>

                    <!-- أزرار التحميل -->
                    <div class="setup-actions" style="margin-top: 2rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button onclick="downloadClientScript()" class="btn btn-success" style="padding: 1rem;">
                            <i class="fas fa-download"></i>
                            تحميل device_client.py
                        </button>
                        <button onclick="downloadConfigFile()" class="btn btn-info" style="padding: 1rem;">
                            <i class="fas fa-file-code"></i>
                            تحميل device_config.json
                        </button>
                        <button onclick="downloadSetupGuide()" class="btn btn-warning" style="padding: 1rem;">
                            <i class="fas fa-book"></i>
                            تحميل دليل الإعداد
                        </button>
                        <button onclick="generateQuickSetup()" class="btn btn-primary" style="padding: 1rem;">
                            <i class="fas fa-magic"></i>
                            إعداد سريع (كل الملفات)
                        </button>
                    </div>

                    <!-- خطوات التشغيل -->
                    <div class="setup-steps" style="margin-top: 2rem; background: rgba(255, 255, 255, 0.05); padding: 1.5rem; border-radius: 12px;">
                        <h4 style="margin-bottom: 1rem;"><i class="fas fa-list-ol"></i> خطوات التشغيل:</h4>
                        <ol style="color: rgba(255, 255, 255, 0.9); line-height: 2;">
                            <li>قم بتحميل الملفات المطلوبة (device_client.py و device_config.json)</li>
                            <li>انسخ الملفات إلى الجهاز المراد مراقبته</li>
                            <li>ثبّت المكتبات المطلوبة: <code style="background: rgba(0, 0, 0, 0.3); padding: 0.2rem 0.5rem; border-radius: 4px;">pip install requests psutil</code></li>
                            <li>شغّل العميل: <code style="background: rgba(0, 0, 0, 0.3); padding: 0.2rem 0.5rem; border-radius: 4px;">python device_client.py</code></li>
                            <li>ستظهر البيانات تلقائياً في لوحة التحكم!</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- الرسم البياني للأداء -->
    <div class="performance-chart">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-chart-line"></i>
                    تطور الأداء
                </h3>
            </div>
            <div class="card-body">
                <canvas id="performance-chart" width="800" height="300"></canvas>
            </div>
        </div>
    </div>

    <!-- سجل الأحداث -->
    <div class="events-log">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-history"></i>
                    سجل الأحداث
                </h3>
            </div>
            <div class="card-body">
                <div class="events-list">
                    <div class="event-item">
                        <div class="event-time">2024-01-15 10:30:00</div>
                        <div class="event-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="event-message">تم تحديث بيانات الجهاز</div>
                    </div>
                    <div class="event-item">
                        <div class="event-time">2024-01-15 10:25:00</div>
                        <div class="event-icon warning">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="event-message">ارتفاع في استخدام الذاكرة</div>
                    </div>
                    <div class="event-item">
                        <div class="event-time">2024-01-15 10:20:00</div>
                        <div class="event-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="event-message">تم إعادة تشغيل الجهاز</div>
                    </div>
                    <div class="event-item">
                        <div class="event-time">2024-01-15 09:45:00</div>
                        <div class="event-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="event-message">تم تحديث النظام</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- نافذة إجراءات الجهاز -->
{% if session.role in ['admin', 'technician', 'manager'] %}
<div id="device-actions-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h3>إجراءات الجهاز - {{ device.name }}</h3>
            <button class="close" onclick="closeDeviceActionsModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="action-buttons-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                <button class="action-btn btn btn-warning" onclick="executeDeviceAction('restart', 'إعادة تشغيل الجهاز')">
                    <i class="fas fa-redo"></i>
                    <span>إعادة تشغيل</span>
                </button>
                <button class="action-btn btn btn-danger" onclick="executeDeviceAction('shutdown', 'إيقاف تشغيل الجهاز')">
                    <i class="fas fa-power-off"></i>
                    <span>إيقاف التشغيل</span>
                </button>
                <button class="action-btn btn btn-info" onclick="executeDeviceAction('reboot', 'إعادة تشغيل الجهاز')">
                    <i class="fas fa-sync-alt"></i>
                    <span>إعادة التشغيل</span>
                </button>
                <button class="action-btn btn btn-secondary" onclick="executeDeviceAction('sleep', 'وضع السكون')">
                    <i class="fas fa-moon"></i>
                    <span>وضع السكون</span>
                </button>
                <button class="action-btn btn btn-secondary" onclick="executeDeviceAction('hibernate', 'وضع السبات')">
                    <i class="fas fa-bed"></i>
                    <span>وضع السبات</span>
                </button>
                <button class="action-btn btn btn-primary" onclick="executeDeviceAction('update', 'تحديث النظام')">
                    <i class="fas fa-sync"></i>
                    <span>تحديث النظام</span>
                </button>
                <button class="action-btn btn btn-success" onclick="executeDeviceAction('scan', 'فحص الجهاز')">
                    <i class="fas fa-search"></i>
                    <span>فحص الجهاز</span>
                </button>
                <button class="action-btn btn btn-info" onclick="executeDeviceAction('backup', 'نسخ احتياطي')">
                    <i class="fas fa-save"></i>
                    <span>نسخ احتياطي</span>
                </button>
                <button class="action-btn btn btn-danger" onclick="showEmergencyAlertModal()" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); border: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>تنبيه طارئ</span>
                </button>
            </div>
            
            <!-- Modal للتنبيه الطارئ -->
            <div id="emergency-alert-modal" class="modal" style="display: none;">
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white;">
                        <h3 style="margin: 0;">
                            <i class="fas fa-exclamation-triangle"></i>
                            إرسال تنبيه طارئ
                        </h3>
                        <span class="close" onclick="closeEmergencyAlertModal()" style="color: white;">&times;</span>
                    </div>
                    <div class="modal-body" style="padding: 2rem;">
                        <div style="margin-bottom: 1.5rem;">
                            <label for="emergency-alert-message" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">
                                الرسالة:
                            </label>
                            <textarea 
                                id="emergency-alert-message" 
                                class="form-control" 
                                rows="4" 
                                placeholder="أدخل رسالة التنبيه الطارئ..."
                                style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;"
                            >تنبيه طارئ: يرجى الاتصال بقسم تكنولوجيا المعلومات فوراً</textarea>
                        </div>
                        <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
                            <i class="fas fa-info-circle" style="color: #856404; margin-left: 0.5rem;"></i>
                            <strong style="color: #856404;">ملاحظة:</strong>
                            <p style="margin: 0.5rem 0 0 0; color: #856404; font-size: 0.9rem;">
                                سيتم عرض هذه الرسالة على شاشة الجهاز بخلفية حمراء مع صوت تنبيه. استخدم هذا الإجراء فقط في حالات الطوارئ.
                            </p>
                        </div>
                        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                            <button onclick="closeEmergencyAlertModal()" class="btn btn-secondary" style="padding: 0.75rem 1.5rem;">
                                إلغاء
                            </button>
                            <button onclick="sendEmergencyAlert()" class="btn btn-danger" style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); border: none;">
                                <i class="fas fa-paper-plane"></i>
                                إرسال التنبيه
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="actions-history" style="margin-top: 2rem;">
                <h4>سجل الإجراءات</h4>
                <div id="actions-list" style="max-height: 300px; overflow-y: auto;">
                    <!-- سيتم ملؤها بواسطة JavaScript -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_css %}
<style>
    .device-details-page {
        max-width: 1400px;
        margin: 0 auto;
        padding: 1.5rem;
    }

    .breadcrumb {
        display: flex;
        list-style: none;
        padding: 0;
        margin: 0 0 1rem 0;
        background: none;
    }

    .breadcrumb-item {
        color: #7f8c8d;
        text-decoration: none;
        margin-left: 0.5rem;
    }

    .breadcrumb-item:not(:last-child)::after {
        content: '>';
        margin: 0 0.5rem;
        color: #7f8c8d;
    }

    .breadcrumb-item.active {
        color: #2c3e50;
        font-weight: bold;
    }

    .status-overview {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .status-main {
        display: flex;
        align-items: center;
    }

    .status-icon {
        font-size: 3rem;
        margin-left: 1rem;
    }

    .status-icon.healthy {
        color: #27ae60;
    }

    .status-icon.warning {
        color: #f39c12;
    }

    .status-icon.critical {
        color: #e74c3c;
    }

    .status-title {
        font-size: 1.5rem;
        color: #2c3e50;
        margin-bottom: 0.5rem;
    }

    .status-description {
        color: #7f8c8d;
        margin: 0;
    }

    .metric-display {
        text-align: center;
    }

    .metric-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 1rem;
    }

    .metric-info {
        display: flex;
        justify-content: space-between;
        margin-top: 1rem;
    }

    .metric-label {
        font-size: 0.9rem;
        color: #7f8c8d;
    }

    .metric-status {
        font-weight: bold;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.8rem;
    }

    .metric-status.normal {
        background: #d4edda;
        color: #155724;
    }

    .metric-status.warning {
        background: #fff3cd;
        color: #856404;
    }

    .metric-status.danger {
        background: #f8d7da;
        color: #721c24;
    }

    .battery-info {
        text-align: center;
    }

    .battery-level {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
    }

    .battery-icon {
        font-size: 3rem;
        color: #3498db;
        margin-left: 1rem;
    }

    .battery-percentage {
        font-size: 2rem;
        font-weight: bold;
        color: #2c3e50;
    }

    .battery-status {
        margin-top: 1rem;
    }

    .status-normal {
        color: #27ae60;
        font-weight: bold;
    }

    .status-warning {
        color: #f39c12;
        font-weight: bold;
    }

    .status-danger {
        color: #e74c3c;
        font-weight: bold;
    }

    .connection-info {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        border-bottom: 1px solid #ecf0f1;
    }

    .info-item:last-child {
        border-bottom: none;
    }

    .info-label {
        font-weight: bold;
        color: #2c3e50;
    }

    .info-value {
        color: #7f8c8d;
    }

    .status-online {
        color: #27ae60;
        font-weight: bold;
    }

    .status-online i {
        font-size: 0.8rem;
        margin-left: 0.25rem;
    }

    .events-list {
        max-height: 400px;
        overflow-y: auto;
    }

    .event-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid #ecf0f1;
        transition: background-color 0.3s ease;
    }

    .event-item:hover {
        background: #f8f9fa;
    }

    .event-item:last-child {
        border-bottom: none;
    }

    .event-time {
        width: 150px;
        font-size: 0.9rem;
        color: #7f8c8d;
        margin-left: 1rem;
    }

    .event-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #3498db;
        color: white;
        margin-left: 1rem;
    }

    .event-icon.warning {
        background: #f39c12;
    }

    .event-message {
        flex: 1;
        color: #2c3e50;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 0;
        border: 1px solid #888;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-width: 800px;
        width: 90%;
    }

    .modal-header {
        padding: 1.5rem;
        border-bottom: 1px solid #ddd;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px 10px 0 0;
    }

    .modal-header h3 {
        margin: 0;
        font-size: 1.5rem;
    }

    .modal-body {
        padding: 1.5rem;
        max-height: 70vh;
        overflow-y: auto;
    }

    .close {
        color: white;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        background: none;
        border: none;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .close:hover,
    .close:focus {
        opacity: 0.7;
    }

    .action-buttons-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .action-btn {
        padding: 1.5rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        color: white;
        font-weight: bold;
        font-size: 1rem;
    }

    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .action-btn i {
        font-size: 2rem;
    }

    .badge {
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.875rem;
        font-weight: 500;
        display: inline-block;
    }

    .badge-success {
        background-color: #28a745;
        color: white;
    }

    .badge-danger {
        background-color: #dc3545;
        color: white;
    }

    .badge-warning {
        background-color: #ffc107;
        color: #212529;
    }

    #actions-list {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 0.5rem;
    }

    @media (max-width: 768px) {
        .status-overview {
            flex-direction: column;
            text-align: center;
        }
        
        .status-main {
            flex-direction: column;
            margin-bottom: 1rem;
        }
        
        .metric-info {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .battery-level {
            flex-direction: column;
        }
        
        .event-item {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .event-time {
            width: auto;
            margin: 0 0 0.5rem 0;
        }
        
        .event-icon {
            margin: 0 0 0.5rem 0;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // تعريف device_id كمتغير JavaScript (من data attribute)
    const deviceId = parseInt(document.querySelector('.device-details-page').getAttribute('data-device-id')) || 0;
    
    // عرض نافذة الإجراءات
    function showDeviceActions() {
        const modal = document.getElementById('device-actions-modal');
        if (modal) {
            modal.style.display = 'block';
            loadDeviceActions();
        }
    }

    // إغلاق نافذة الإجراءات
    function closeDeviceActionsModal() {
        const modal = document.getElementById('device-actions-modal');
        if (modal) {
            modal.style.display = 'none';
        }
    }

    // تنفيذ إجراء على الجهاز
    function executeDeviceAction(actionType, actionDescription) {
        
        if (!confirm(`هل أنت متأكد من تنفيذ الإجراء "${actionDescription}" على هذا الجهاز؟`)) {
            return;
        }

        fetch(`/actions/api/device/${deviceId}/execute`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                action_type: actionType,
                action_description: actionDescription
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                showNotification(`خطأ: ${data.error}`, 'error');
                return;
            }

            if (data.success) {
                showNotification(`تم إنشاء الإجراء "${actionDescription}" بنجاح. سيتم تنفيذه عند اتصال الجهاز بالخادم.`, 'success');
                loadDeviceActions(); // إعادة تحميل قائمة الإجراءات
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('حدث خطأ في تنفيذ الإجراء', 'error');
        });
    }
    
    // وظائف التنبيه الطارئ
    function showEmergencyAlertModal() {
        const modal = document.getElementById('emergency-alert-modal');
        if (modal) {
            modal.style.display = 'block';
            // تعيين قيمة افتراضية للرسالة
            const messageTextarea = document.getElementById('emergency-alert-message');
            if (messageTextarea && !messageTextarea.value.trim()) {
                messageTextarea.value = 'تنبيه طارئ: يرجى الاتصال بقسم تكنولوجيا المعلومات فوراً';
            }
        }
    }
    
    function closeEmergencyAlertModal() {
        const modal = document.getElementById('emergency-alert-modal');
        if (modal) {
            modal.style.display = 'none';
        }
    }
    
    function sendEmergencyAlert() {
        const messageTextarea = document.getElementById('emergency-alert-message');
        if (!messageTextarea) {
            showNotification('خطأ: لم يتم العثور على حقل الرسالة', 'error');
            return;
        }
        
        const alertMessage = messageTextarea.value.trim();
        if (!alertMessage) {
            showNotification('يرجى إدخال رسالة التنبيه', 'error');
            return;
        }
        
        // تأكيد إرسال التنبيه الطارئ
        if (!confirm(`⚠️ تحذير: سيتم عرض رسالة طارئة على شاشة الجهاز بخلفية حمراء مع صوت تنبيه.\n\nالرسالة: "${alertMessage}"\n\nهل أنت متأكد من إرسال هذا التنبيه؟`)) {
            return;
        }
        
        // إرسال التنبيه
        fetch(`/actions/api/device/${deviceId}/execute`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                action_type: 'emergency_alert',
                action_description: 'تنبيه طارئ',
                alert_message: alertMessage
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                showNotification(`خطأ: ${data.error}`, 'error');
                return;
            }

            if (data.success) {
                showNotification(`✓ تم إرسال التنبيه الطارئ بنجاح! سيتم عرضه على الجهاز عند اتصاله بالخادم.`, 'success');
                closeEmergencyAlertModal();
                loadDeviceActions(); // إعادة تحميل قائمة الإجراءات
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('حدث خطأ في إرسال التنبيه', 'error');
        });
    }

    // تحميل سجل الإجراءات
    function loadDeviceActions() {
        fetch(`/actions/api/device/${deviceId}/actions`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                console.error('Error loading actions:', data.error);
                const actionsList = document.getElementById('actions-list');
                if (actionsList) {
                    actionsList.innerHTML = '<p style="text-align: center; color: #999;">خطأ في تحميل الإجراءات</p>';
                }
                return;
            }

            const actionsList = document.getElementById('actions-list');
            if (!actionsList) return;

            if (data.length === 0) {
                actionsList.innerHTML = '<p style="text-align: center; color: #999;">لا توجد إجراءات حتى الآن</p>';
                return;
            }

            actionsList.innerHTML = data.map(action => {
                const statusClass = action.status === 'completed' ? 'success' : 
                                   action.status === 'failed' ? 'danger' : 'warning';
                const statusText = action.status === 'completed' ? 'مكتمل' :
                                  action.status === 'failed' ? 'فشل' : 'قيد التنفيذ';
                const date = new Date(action.created_at);
                const formattedDate = date.toLocaleString('ar-SA', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                return `
                    <div style="padding: 0.75rem; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${action.action_description}</strong>
                            <br>
                            <small style="color: #666;">
                                من: ${action.performed_by_name || action.performed_by}
                                | ${formattedDate}
                            </small>
                        </div>
                        <span class="badge badge-${statusClass}">${statusText}</span>
                    </div>
                `;
            }).join('');
        })
        .catch(error => {
            console.error('Error loading actions:', error);
            const actionsList = document.getElementById('actions-list');
            if (actionsList) {
                actionsList.innerHTML = '<p style="text-align: center; color: #999;">خطأ في تحميل الإجراءات</p>';
            }
        });
    }

    // إغلاق النافذة عند النقر خارجها
    window.onclick = function(event) {
        const modal = document.getElementById('device-actions-modal');
        if (event.target == modal) {
            closeDeviceActionsModal();
        }
        
        const emergencyModal = document.getElementById('emergency-alert-modal');
        if (event.target == emergencyModal) {
            closeEmergencyAlertModal();
        }
    }
    
    // إغلاق modal التنبيه الطارئ عند الضغط على ESC
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeEmergencyAlertModal();
        }
    });

    // إنشاء الرسم البياني
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('performance-chart');
        if (ctx) {
            createPerformanceChart(ctx);
        }
    });

    function createPerformanceChart(canvas) {
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        
        // مسح القماش
        ctx.clearRect(0, 0, width, height);
        
        // بيانات وهمية
        const data = {
            labels: ['09:00', '09:30', '10:00', '10:30', '11:00', '11:30', '12:00'],
            cpu: [45, 52, 48, 65, 70, 68, 45],
            ram: [60, 65, 62, 75, 80, 78, 60],
            disk: [70, 72, 71, 75, 78, 76, 70]
        };
        
        // إعدادات الرسم
        const padding = 40;
        const chartWidth = width - (padding * 2);
        const chartHeight = height - (padding * 2);
        
        // رسم المحاور
        ctx.strokeStyle = '#ecf0f1';
        ctx.lineWidth = 1;
        
        // المحور الأفقي
        ctx.beginPath();
        ctx.moveTo(padding, height - padding);
        ctx.lineTo(width - padding, height - padding);
        ctx.stroke();
        
        // المحور العمودي
        ctx.beginPath();
        ctx.moveTo(padding, padding);
        ctx.lineTo(padding, height - padding);
        ctx.stroke();
        
        // رسم الخطوط
        const colors = {
            cpu: '#3498db',
            ram: '#e74c3c',
            disk: '#f39c12'
        };
        
        Object.keys(colors).forEach(key => {
            ctx.strokeStyle = colors[key];
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            data[key].forEach((value, index) => {
                const x = padding + (index * (chartWidth / (data.labels.length - 1)));
                const y = height - padding - (value / 100 * chartHeight);
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
        });
        
        // رسم النقاط
        Object.keys(colors).forEach(key => {
            ctx.fillStyle = colors[key];
            
            data[key].forEach((value, index) => {
                const x = padding + (index * (chartWidth / (data.labels.length - 1)));
                const y = height - padding - (value / 100 * chartHeight);
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });
        });
        
        // رسم التسميات
        ctx.fillStyle = '#2c3e50';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        
        data.labels.forEach((label, index) => {
            const x = padding + (index * (chartWidth / (data.labels.length - 1)));
            ctx.fillText(label, x, height - padding + 20);
        });
        
        // رسم المفتاح
        const legendY = padding + 20;
        Object.keys(colors).forEach((key, index) => {
            const x = width - 150;
            const y = legendY + (index * 20);
            
            ctx.fillStyle = colors[key];
            ctx.fillRect(x, y - 8, 12, 12);
            
            ctx.fillStyle = '#2c3e50';
            ctx.textAlign = 'right';
            ctx.fillText(key.toUpperCase(), x - 10, y);
        });
    }

    // تعيين أشرطة التقدم
    function setProgressBars() {
        const progressBars = document.querySelectorAll('.progress-bar[data-width]');
        progressBars.forEach(bar => {
            const width = bar.getAttribute('data-width');
            const usage = parseInt(bar.getAttribute('data-usage'));
            
            bar.style.width = width + '%';
            
            if (usage > 90) {
                bar.classList.add('progress-bar-danger');
            } else if (usage > 70) {
                bar.classList.add('progress-bar-warning');
            }
        });
    }

    // تشغيل تعيين أشرطة التقدم عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', function() {
        setProgressBars();
    });

    // نسخ Device Token
    function copyDeviceToken() {
        const tokenInput = document.getElementById('device-token-input');
        if (tokenInput) {
            tokenInput.select();
            document.execCommand('copy');
            showNotification('تم نسخ Device Token إلى الحافظة', 'success');
        }
    }

    // تحميل device_client.py
    function downloadClientScript() {
        fetch('/devices/api/' + deviceId + '/download-client')
            .then(response => response.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'device_client.py';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showNotification('تم تحميل device_client.py بنجاح', 'success');
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('حدث خطأ أثناء التحميل', 'error');
            });
    }

    // تحميل device_config.json
    function downloadConfigFile() {
        const deviceToken = document.getElementById('device-token-input').value;
        const serverUrl = document.getElementById('server-url-input').value;
        
        if (!deviceToken || deviceToken === 'غير متوفر') {
            showNotification('Device Token غير متوفر', 'error');
            return;
        }

        const config = {
            "device_token": deviceToken,
            "server_url": serverUrl
        };

        const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'device_config.json';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
        showNotification('تم تحميل device_config.json بنجاح', 'success');
    }

    // تحميل دليل الإعداد
    function downloadSetupGuide() {
        fetch('/devices/api/' + deviceId + '/download-guide')
            .then(response => response.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'دليل_الإعداد.txt';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showNotification('تم تحميل دليل الإعداد بنجاح', 'success');
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('حدث خطأ أثناء التحميل', 'error');
            });
    }

    // إعداد سريع - تحميل جميع الملفات
    function generateQuickSetup() {
        const deviceToken = document.getElementById('device-token-input').value;
        const serverUrl = document.getElementById('server-url-input').value;
        
        if (!deviceToken || deviceToken === 'غير متوفر') {
            showNotification('Device Token غير متوفر', 'error');
            return;
        }

        // تحميل device_client.py
        downloadClientScript();
        
        // انتظار قليل ثم تحميل config
        setTimeout(() => {
            downloadConfigFile();
        }, 500);
        
        // انتظار قليل ثم تحميل الدليل
        setTimeout(() => {
            downloadSetupGuide();
        }, 1000);

        showNotification('جارٍ تحميل جميع الملفات...', 'info');
    }

    // عرض الإشعارات
    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? 'rgba(39, 174, 96, 0.9)' : type === 'error' ? 'rgba(231, 76, 60, 0.9)' : 'rgba(67, 97, 238, 0.9)'};
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        `;
        notification.innerHTML = `
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            </div>
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 100);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(150%)';
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }
</script>
{% endblock %}


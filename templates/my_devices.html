{% extends "base.html" %}

{% block title %}Ø£Ø¬Ù‡Ø²ØªÙŠ - Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©{% endblock %}

{% block content %}
<div class="my-devices-page">
    <div class="page-header">
        <div class="card">
            <div class="card-header">
                <h1 class="page-title">
                    <i class="fas fa-desktop"></i>
                    Ø£Ø¬Ù‡Ø²ØªÙŠ
                </h1>
                <p class="page-subtitle">Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ø£Ø¬Ù‡Ø²ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</p>
            </div>
        </div>
    </div>

    <!-- Ø¹Ø±Ø¶ Token Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹) -->
    {% if new_device_token %}
    <div class="new-device-token-section mb-4">
        <div class="card" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none;">
            <div class="card-body text-center">
                <h3><i class="fas fa-check-circle"></i> ØªÙ… Ø±Ø¨Ø· Ø¬Ù‡Ø§Ø²Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹!</h3>
                <p class="mb-3" style="font-size: 16px;">
                    Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Token Ù„Ø±Ø¨Ø· Ø¬Ù‡Ø§Ø²Ùƒ:
                </p>
                <div class="token-display mb-3" style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; word-break: break-all;">
                    <code id="device-token-display" style="color: white; font-size: 14px; font-weight: bold;">{{ new_device_token }}</code>
                </div>
                <button class="btn btn-light btn-lg mb-2" onclick="copyToken('{{ new_device_token }}')" style="color: #28a745; font-weight: bold;">
                    <i class="fas fa-copy"></i> Ù†Ø³Ø® Token
                </button>
                <p class="mt-3 mb-0" style="font-size: 14px; opacity: 0.9;">
                    <i class="fas fa-info-circle"></i> 
                    Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Token ÙˆØ§Ø³ØªØ®Ø¯Ù…Ù‡ ÙÙŠ device_client.py Ø£Ùˆ start_client.bat
                </p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Ø²Ø± Ø±Ø¨Ø· Ø§Ù„Ø¬Ù‡Ø§Ø² -->
    <div class="connect-device-section mb-4">
        <div class="card">
            <div class="card-body text-center">
                <h3>Ø±Ø¨Ø· Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯</h3>
                <p class="text-muted">
                    Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø±Ø¨Ø· Ø¬Ù‡Ø§Ø²Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹<br>
                    <small class="text-info">
                        <i class="fas fa-info-circle"></i> 
                        Ø³ÙŠØªÙ… Ø¬Ù„Ø¨ MAC Ùˆ IP ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¹Ù†Ø¯ ØªØ´ØºÙŠÙ„ device_client.py
                    </small>
                </p>
                <button class="btn btn-primary btn-lg" id="connect-device-btn" onclick="connectDevice()">
                    <i class="fas fa-plug"></i>
                    Ø±Ø¨Ø· Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯
                </button>
                <div id="connect-status" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© -->
    <div class="devices-list-section">
        <div class="card">
            <div class="card-header">
                <h3>Ø£Ø¬Ù‡Ø²ØªÙŠ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©</h3>
            </div>
            <div class="card-body">
                <div id="devices-list" class="devices-grid">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                </div>
                <div id="loading" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                    </div>
                </div>
                <div id="no-devices" class="text-center py-5" style="display: none;">
                    <i class="fas fa-desktop fa-3x text-muted mb-3"></i>
                    <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¬Ù‡Ø²Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø¹Ø¯</p>
                    <p class="text-muted">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø±Ø¨Ø· Ø§Ù„Ø¬Ù‡Ø§Ø²" Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø²Ùƒ</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.my-devices-page {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

.connect-device-section .card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.connect-device-section .card-body {
    padding: 40px;
}

.connect-device-section h3 {
    color: white;
    margin-bottom: 10px;
}

.connect-device-section .text-muted {
    color: rgba(255, 255, 255, 0.8) !important;
}

#connect-device-btn {
    background: white;
    color: #667eea;
    border: none;
    padding: 15px 40px;
    font-size: 18px;
    font-weight: bold;
    border-radius: 50px;
    transition: all 0.3s;
}

#connect-device-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

#connect-device-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.devices-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.device-card {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 10px;
    padding: 20px;
    transition: all 0.3s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.device-card:hover {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    transform: translateY(-2px);
}

.device-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.device-name {
    font-size: 18px;
    font-weight: bold;
    color: #333;
}

.device-status {
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
}

.device-status.healthy {
    background: #d4edda;
    color: #155724;
}

.device-status.warning {
    background: #fff3cd;
    color: #856404;
}

.device-status.critical {
    background: #f8d7da;
    color: #721c24;
}

.device-metrics {
    margin-top: 15px;
}

.metric-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #f0f0f0;
}

.metric-item:last-child {
    border-bottom: none;
}

.metric-label {
    color: #666;
    font-size: 14px;
}

.metric-value {
    font-weight: bold;
    color: #333;
}

#connect-status {
    min-height: 30px;
}

.status-message {
    padding: 10px;
    border-radius: 5px;
    margin-top: 10px;
}

.status-message.success {
    background: #d4edda;
    color: #155724;
}

.status-message.error {
    background: #f8d7da;
    color: #721c24;
}

.status-message.info {
    background: #d1ecf1;
    color: #0c5460;
}
</style>

<script>
let autoRefreshInterval = null;

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
function loadDevices() {
    fetch('/my-devices/api/list')
        .then(response => response.json())
        .then(data => {
            const devicesList = document.getElementById('devices-list');
            const loading = document.getElementById('loading');
            const noDevices = document.getElementById('no-devices');
            
            loading.style.display = 'none';
            
            if (data.error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©:', data.error);
                return;
            }
            
            if (data.length === 0) {
                noDevices.style.display = 'block';
                devicesList.innerHTML = '';
                return;
            }
            
            noDevices.style.display = 'none';
            devicesList.innerHTML = data.map(device => `
                <div class="device-card">
                    <div class="device-header">
                        <div class="device-name">${device.name || 'Ø¬Ù‡Ø§Ø² Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
                        <span class="device-status ${device.status || 'healthy'}">${getStatusText(device.status)}</span>
                    </div>
                    <div class="device-info">
                        <div class="metric-item">
                            <span class="metric-label">Ø§Ù„Ù†ÙˆØ¹:</span>
                            <span class="metric-value">${device.device_type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Ø§Ù„Ù…ÙˆÙ‚Ø¹:</span>
                            <span class="metric-value">${device.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        </div>
                        ${device.ip_address ? `
                        <div class="metric-item">
                            <span class="metric-label">IP:</span>
                            <span class="metric-value">${device.ip_address}</span>
                        </div>
                        ` : ''}
                    </div>
                    <div class="device-metrics">
                        <h5 style="margin-top: 15px; margin-bottom: 10px; color: #666; font-size: 14px;">Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª:</h5>
                        ${device.cpu_usage !== null ? `
                        <div class="metric-item">
                            <span class="metric-label">Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬:</span>
                            <span class="metric-value">${device.cpu_usage}%</span>
                        </div>
                        ` : '<div class="metric-item"><span class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯</span></div>'}
                        ${device.ram_usage !== null ? `
                        <div class="metric-item">
                            <span class="metric-label">Ø§Ù„Ø°Ø§ÙƒØ±Ø©:</span>
                            <span class="metric-value">${device.ram_usage}%</span>
                        </div>
                        ` : ''}
                        ${device.disk_usage !== null ? `
                        <div class="metric-item">
                            <span class="metric-label">Ø§Ù„Ù‚Ø±Øµ:</span>
                            <span class="metric-value">${device.disk_usage}%</span>
                        </div>
                        ` : ''}
                        ${device.temperature !== null && device.temperature !== undefined && device.temperature > 0 ? `
                        <div class="metric-item">
                            <span class="metric-label">Ø§Ù„Ø­Ø±Ø§Ø±Ø©:</span>
                            <span class="metric-value">${device.temperature}Â°C</span>
                        </div>
                        ` : ''}
                        ${device.battery_level !== null ? `
                        <div class="metric-item">
                            <span class="metric-label">Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©:</span>
                            <span class="metric-value">${device.battery_level}%</span>
                        </div>
                        ` : ''}
                    </div>
                    ${device.device_token ? `
                    <div class="mt-3">
                        <button class="btn btn-sm btn-outline-primary" onclick="copyToken('${device.device_token}')">
                            <i class="fas fa-copy"></i> Ù†Ø³Ø® Token
                        </button>
                        <a href="/devices/${device.id}" class="btn btn-sm btn-outline-info">
                            <i class="fas fa-info-circle"></i> Ø§Ù„ØªÙØ§ØµÙŠÙ„
                        </a>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteDevice(${device.id}, '${device.name}')">
                            <i class="fas fa-trash"></i> Ø­Ø°Ù
                        </button>
                    </div>
                    ` : ''}
                </div>
            `).join('');
        })
        .catch(error => {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©:', error);
            document.getElementById('loading').style.display = 'none';
        });
}

// Ø±Ø¨Ø· Ø§Ù„Ø¬Ù‡Ø§Ø²
function connectDevice() {
    const btn = document.getElementById('connect-device-btn');
    const status = document.getElementById('connect-status');
    
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±Ø¨Ø·...';
    status.innerHTML = '<div class="status-message info">Ø¬Ø§Ø±ÙŠ Ø±Ø¨Ø· Ø§Ù„Ø¬Ù‡Ø§Ø²...</div>';
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const deviceName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²:', `Ø¬Ù‡Ø§Ø² ${new Date().toLocaleDateString('ar')}`) || `Ø¬Ù‡Ø§Ø² ${new Date().getTime()}`;
    const deviceLocation = prompt('Ø£Ø¯Ø®Ù„ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ù‡Ø§Ø² (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):', 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    
    if (!deviceName) {
        status.innerHTML = '<div class="status-message error">ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²</div>';
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-plug"></i> Ø±Ø¨Ø· Ø§Ù„Ø¬Ù‡Ø§Ø²';
        return;
    }
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ù‡Ø§Ø² (Ø¨Ø¯ÙˆÙ† MAC/IP - Ø³ÙŠØªÙ… Ø¬Ù„Ø¨Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† device_client.py)
    fetch('/my-devices/api/register', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            name: deviceName,
            device_type: 'computer',
            location: deviceLocation
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            status.innerHTML = `<div class="status-message error">Ø®Ø·Ø£: ${data.error}</div>`;
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-plug"></i> Ø±Ø¨Ø· Ø§Ù„Ø¬Ù‡Ø§Ø²';
            return;
        }
        
        if (data.success) {
            status.innerHTML = `<div class="status-message success">
                <strong>âœ“ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ù†Ø¬Ø§Ø­!</strong><br>
                Device ID: ${data.device_id}
            </div>`;
            
            // Ø¹Ø±Ø¶ token ÙˆØ§Ù„ instructions
            if (data.device_token) {
                const serverUrl = window.location.origin;
                status.innerHTML += `
                    <div class="status-message info mt-3">
                        <strong>ğŸ”‘ Device Token:</strong><br>
                        <code style="word-break: break-all; background: #f8f9fa; padding: 10px; display: block; margin: 10px 0; border-radius: 5px;">${data.device_token}</code>
                        <button class="btn btn-sm btn-primary mt-2" onclick="copyToken('${data.device_token}')">
                            <i class="fas fa-copy"></i> Ù†Ø³Ø® Token
                        </button>
                    </div>
                    <div class="status-message info mt-3">
                        <strong>ğŸ“‹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:</strong><br>
                        <ol style="text-align: right; margin-top: 10px; padding-right: 20px;">
                            <li>Ø§Ù†Ø³Ø® Token Ø£Ø¹Ù„Ø§Ù‡</li>
                            <li>Ø§ÙØªØ­ terminal/cmd Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø±Ø§Ø¯ Ù…Ø±Ø§Ù‚Ø¨ØªÙ‡</li>
                            <li>Ø´ØºÙ‘Ù„ Ø§Ù„Ø£Ù…Ø± Ø§Ù„ØªØ§Ù„ÙŠ:<br>
                                <code style="background: #f8f9fa; padding: 5px; display: inline-block; margin-top: 5px;">
                                    python device_client.py ${serverUrl} ${data.device_token}
                                </code>
                            </li>
                            <li><strong>Ø³ÙŠØªÙ… Ø¬Ù„Ø¨ MAC Ùˆ IP ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²!</strong></li>
                            <li>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ØªØ±Ø³Ù„ ÙƒÙ„ Ø«Ø§Ù†ÙŠØªÙŠÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
                        </ol>
                        <div class="mt-3 p-3" style="background: #e7f3ff; border-radius: 5px;">
                            <strong>ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong><br>
                            Ù„Ø§ ØªØ­ØªØ§Ø¬ Ù„Ø¥Ø¯Ø®Ø§Ù„ MAC Ø£Ùˆ IP ÙŠØ¯ÙˆÙŠØ§Ù‹!<br>
                            device_client.py ÙŠØ¬Ù„Ø¨Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù….
                        </div>
                    </div>
                `;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
            loadDevices();
        }
        
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-plug"></i> Ø±Ø¨Ø· Ø§Ù„Ø¬Ù‡Ø§Ø²';
    })
    .catch(error => {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø±Ø¨Ø· Ø§Ù„Ø¬Ù‡Ø§Ø²:', error);
        status.innerHTML = `<div class="status-message error">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ${error.message}</div>`;
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-plug"></i> Ø±Ø¨Ø· Ø§Ù„Ø¬Ù‡Ø§Ø²';
    });
}

// Ù†Ø³Ø® Token
function copyToken(token) {
    navigator.clipboard.writeText(token).then(() => {
        showNotification('ØªÙ… Ù†Ø³Ø® Token Ø¨Ù†Ø¬Ø§Ø­!', 'success');
    }).catch(err => {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ù†Ø³Ø® Token:', err);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù†Ø³Ø® Token', 'error');
    });
}

// Ø­Ø°Ù Ø§Ù„Ø¬Ù‡Ø§Ø²
function deleteDevice(deviceId, deviceName) {
    if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¬Ù‡Ø§Ø² "${deviceName}"ØŸ\n\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª.\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`)) {
        return;
    }
    
    fetch(`/my-devices/api/delete/${deviceId}`, {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            showNotification(`Ø®Ø·Ø£: ${data.error}`, 'error');
            return;
        }
        
        if (data.success) {
            showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ù†Ø¬Ø§Ø­', 'success');
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
            loadDevices();
        }
    })
    .catch(error => {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¬Ù‡Ø§Ø²:', error);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¬Ù‡Ø§Ø²', 'error');
    });
}

// Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
function showNotification(message, type = 'info') {
    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    const notification = document.createElement('div');
    notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} alert-dismissible fade show`;
    notification.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px; max-width: 500px;';
    notification.setAttribute('role', 'alert');
    notification.innerHTML = `
        ${message}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close" onclick="this.parentElement.remove()">
            <span aria-hidden="true">&times;</span>
        </button>
    `;
    document.body.appendChild(notification);
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 5000);
}

// Ù†Ø³Ø® Token
function copyToken(token) {
    navigator.clipboard.writeText(token).then(function() {
        alert('âœ“ ØªÙ… Ù†Ø³Ø® Token Ø¨Ù†Ø¬Ø§Ø­!');
    }, function() {
        // Fallback Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        const textarea = document.createElement('textarea');
        textarea.value = token;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('âœ“ ØªÙ… Ù†Ø³Ø® Token Ø¨Ù†Ø¬Ø§Ø­!');
    });
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ø­Ø§Ù„Ø©
function getStatusText(status) {
    const statusMap = {
        'healthy': 'Ø³Ù„ÙŠÙ…',
        'warning': 'ØªØ­Ø°ÙŠØ±',
        'critical': 'Ø­Ø±Ø¬'
    };
    return statusMap[status] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
}

// ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
function startAutoRefresh() {
    if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
    }
    autoRefreshInterval = setInterval(loadDevices, 5000);
}

// Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
function stopAutoRefresh() {
    if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
    }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    loadDevices();
    startAutoRefresh();
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Token Ø¬Ø¯ÙŠØ¯ØŒ Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©
    {% if new_device_token %}
    setTimeout(function() {
        const tokenSection = document.querySelector('.new-device-token-section');
        if (tokenSection) {
            tokenSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }, 500);
    {% endif %}
});

// Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('beforeunload', function() {
    stopAutoRefresh();
});
</script>
{% endblock %}

